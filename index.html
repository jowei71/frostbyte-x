<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FrostByte AI • Works Everywhere</title>
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.1.0/dist/tesseract.min.js"></script>

    <style>
        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
        body,html { height:100dvh; background:#000; color:#0f0; font-family:system-ui,-apple-system,sans-serif; overflow:hidden; }
        #start, #cam, #processing { position:fixed; inset:0; }
        #video { width:100vw; height:100dvh; object-fit:cover; }
        .big-btn { position:fixed; bottom:40px; left:50%; transform:translateX(-50%); width:80px; height:80px; background:#fff; border-radius:50%; box-shadow:0 10px 40px rgba(0,0,0,0.6); z-index:99; }
        .big-btn:active { transform:translateX(-50%) scale(0.9); }
        .shutter { animation:flash 0.2s; }
        @keyframes flash { 50% { background:#fff; } }
        .line { position:fixed; top:0; left:0; right:0; height:4px; background:#0f0; box-shadow:0 0 40px #0f0; animation:scan 3s infinite linear; z-index:10; }
        @keyframes scan { 0% { top:-10% } 100% { top:110% } }
        .hidden { display:none!important; }
        .center { display:flex; align-items:center; justify-content:center; height:100dvh; text-align:center; padding:20px; }
        h1 { font-size:3rem; font-weight:900; margin-bottom:20px; }
        p { font-size:1.2rem; opacity:0.8; }
    </style>
</head>
<body>

    <!-- START SCREEN -->
    <div id="start" class="center flex-col bg-black text-white">
        <h1>FROSTBYTE AI</h1>
        <p>Point at any food · Real AI reads expiry dates</p>
        <button id="open" class="mt-12 px-12 py-6 bg-green-500 text-black text-2xl font-black rounded-2xl shadow-2xl">
            OPEN CAMERA NOW
        </button>
    </div>

    <!-- CAMERA -->
    <div id="cam" class="hidden">
        <video id="video" autoplay playsinline muted></video>
        <div class="line"></div>
        <button id="snap" class="big-btn"></button>
        <button onclick="location.reload()" class="fixed top-8 right-8 text-white text-4xl z-50">X</button>
    </div>

    <!-- PROCESSING -->
    <div id="processing" class="hidden center flex-col bg-black text-white">
        <i class="text-8xl mb-8">Brain</i>
        <p class="text-3xl font-black">Reading expiry date...</p>
    </div>

    <!-- RESULT -->
    <div id="result" class="hidden center flex-col bg-black text-white p-8">
        <div class="text-8xl mb-8" id="emoji">Package</div>
        <h2 class="text-4xl font-black mb-4" id="name">Food Item</h2>
        <p class="text-6xl font-black mb-8" id="days">7 DAYS LEFT</p>
        <button onclick="location.reload()" class="px-12 py-6 bg-green-500 text-black text-2xl font-black rounded-2xl">
            SCAN AGAIN
        </button>
    </div>

    <audio id="shutter" src="https://assets.mixkit.co/sfx/preview/mixkit-camera-shutter-click-564.mp3" preload="auto"></audio>

    <script>
        let stream = null;
        let worker = null;

        // OPEN CAMERA — 100% WORKS
        document.getElementById('open').onclick = async () => {
            document.getElementById('start').classList.add('hidden');
            document.getElementById('cam').classList.remove('hidden');

            try {
                stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: "environment" }
                });
                document.getElementById('video').srcObject = stream;
            } catch(e) {
                alert("Camera blocked. Go to Settings → Safari/Chrome → Camera → Allow");
            }
        };

        // CAPTURE — 100% WORKING BUTTON
        document.getElementById('snap').onclick = async () => {
            // Effects
            document.getElementById('shutter').play();
            document.body.classList.add('shutter');
            setTimeout(() => document.body.classList.remove('shutter'), 200);
            if ('vibrate' in navigator) navigator.vibrate(100);

            // Capture photo
            const video = document.getElementById('video');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            stream.getTracks().forEach(t => t.stop());

            // Show processing
            document.getElementById('cam').classList.add('hidden');
            document.getElementById('processing').classList.remove('hidden');

            // OCR
            worker = worker || await Tesseract.createWorker('eng');
            const { data: { text } } = await worker.recognize(canvas);

            // Find expiry date
            const dateMatch = text.match(/\d{1,2}[\/\-\.]\d{1,2}[\/\-\.]\d{2,4}|\d{4}[\/\-\.]\d{2}[\/\-\.]\d{2}|(?:JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC)[\s\-\/]*\d{1,2}[\s\,]*\d{2,4}/i);
            let daysLeft = 10;
            let name = "Food Item";
            let emoji = "Package";

            if (dateMatch) {
                const parsed = new Date(dateMatch[0]);
                if (!isNaN(parsed)) {
                    daysLeft = Math.max(0, Math.ceil((parsed - new Date()) / 86400000));
                }
            }

            // Guess food name
            const foods = { milk:"Milk", yogurt:"Yogurt", cheese:"Cheese", chicken:"Chicken", egg:"Eggs", bread:"Bread", banana:"Banana" };
            const lower = text.toLowerCase();
            for (let key in foods) {
                if (lower.includes(key)) {
                    name = foods[key];
                    emoji = key === "milk" ? "Milk" : key === "yogurt" ? "Yogurt" : key === "chicken" ? "Chicken" : key === "egg" ? "Eggs" : key === "banana" ? "Banana" : "Cheese";
                    break;
                }
            }

            // Show result
            document.getElementById('processing').classList.add('hidden');
            document.getElementById('result').classList.remove('hidden');
            document.getElementById('name').textContent = name;
            document.getElementById('emoji').textContent = emoji;
            document.getElementById('days').textContent = daysLeft === 0 ? "EXPIRED TODAY" : 
                                                          daysLeft === 1 ? "1 DAY LEFT" : 
                                                          daysLeft <= 3 ? `${daysLeft} DAYS LEFT` : 
                                                          `${daysLeft} DAYS LEFT`;
            document.getElementById('days').style.color = daysLeft <= 2 ? "#ff4444" : "#00ff00";

            confetti({ particleCount: 300, spread: 100, origin: { y: 0.6 } });
        };
    </script>
</body>
</html>